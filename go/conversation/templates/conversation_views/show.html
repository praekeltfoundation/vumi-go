{% extends "conversation_views/conversation_base.html" %}
{% load url from future %}
{% load conversation_tags %}

{% block content_title %}
    Preview &amp; Activate
{% endblock %}

{% block content_actions_right %}
    <a href="{% url 'conversations:index' %}">Cancel</a>
    {% if is_editable %}
        <a href="{% conversation_screen conversation 'edit' %}" class="btn btn-primary">Edit</a>
    {% endif %}
    {# TODO: Proper lifecycle stuff. #}
    {% if conversation.stopped %}
        <a href="{% url 'conversations_tmp:incoming_list' conversation.key %}" class="btn btn-primary">Start</a>
    {% elif conversation.running %}
        <a href="{% url 'conversations_tmp:incoming_list' conversation.key %}" class="btn btn-primary">Stop</a>
    {% else %}
        <a href="{% conversation_screen conversation %}" class="btn btn-primary">???</a>
    {% endif %}
{% endblock %}

{% block content_main %}
<div class="row-fluid indent">
    <div class="span7">

        <h4 class="control-label">
            <a href="{% conversation_screen conversation %}">
                Details
                <button class="btn btn-primary btn-mini">Edit</button>
            </a>
        </h4>

        <p>
            NAME<br>
            {{ conversation.name }}
        </p>
        <p>
            TYPE<br>
            {{ conversation.type }}
        </p>

        <p>
            CHANNELS<br>
            <!-- TODO:  update the routing table metadata helpers to
                        be able to answer questions like this.
            -->
            USSD
        </p>

        <h4 class="control-label">
            Actions
        </h4>

        <p>
            {# TODO: Make this pretty #}
            {% if actions %}
                <ol>
                {% for action in actions %}
                    <li><a href="{% conversation_action conversation action.action_name %}">{{action.action_display_name}}</a></li>
                {% endfor %}
                </ol>
            {% else %}
                This conversation has no actions.
            {% endif %}
        </p>

        <hr>
        <h4 class="control-label">
            <a href="{% url 'conversations_tmp:message' conversation.key %}">
                Messages
                <button class="btn btn-primary btn-mini">Edit</button>
            </a>
        </h4>

        <p class="message">
            {{ conversation.description }}
        </p>


        <hr>
        <h4 class="control-label">
            <a href="{% url 'conversations_tmp:contacts' conversation.key %}">
                Contacts
                <button class="btn btn-primary btn-mini">Edit</button>
            </a>
        </h4>
        <p class="message">
            {# TODO: List of groups contacts #}
            {% if groups %}
                <ol>
                {% for group, member_count in groups.items %}
                    <li>{{group}} ({{member_count}} member{{member_count|pluralize}})</li>
                {% endfor %}
                </ol>
            {% else %}
                You have not specified any contacts.
            {% endif %}
        </p>

    </div>
</div>
{% endblock %}


{% block ondomready %}
    {{ block.super }}
    // highlight the breadcrumbs.
    $('.breadcrumbs a').eq(3).addClass('active');
{% endblock %}
