{% extends "app.html" %}

{% block extra_header %}
    <link type="text/css" href="{{STATIC_URL}}css/smoothness/jquery-ui-1.8.11.custom.css" rel="stylesheet" />
    <link type="text/css" href="{{STATIC_URL}}css/jquery-ui-timepicker.css" rel="stylesheet" />  
{% endblock %}

{% block main %}
    <div class="row">
        <div class="span12">
            <div id="welcome">
                <h1><a href="{% url conversations:index %}">Surveys</a> &raquo; {{conversation.subject}}</h1>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="span12">
            {% include "base/includes/messages.html" %}
        </div>
    </div>
    <div class="row">
        <div class="span12">
            <div class="pull-right">
               {% if conversation.ended %}
                    <h4 class="btn btn-info"><i class="icon-ok icon-white"></i> Survey ended on {{conversation.end_date|date:"d F Y"}}</h4>
                {% else %}
                    <form id="conversation-end" name="conversation-end" method="post" action="{% url survey:end conversation_pk=conversation.pk %}">
                        {% csrf_token %}
                        <a href="javascript: document.getElementById('conversation-end').submit();" class="btn btn-danger"><i class="icon-remove-sign icon-white"></i> End Survey</a>
                    </form>
                {% endif %}
<!--
                <a href="" class="btn btn-success disabled"><i class="icon-repeat icon-white"></i> Resume Survey</a>
-->
            </div>
            <span class="label label-info">{{conversation.start_date|date:"d F Y"}}</span> <span class="label">{{conversation.delivery_class_description}}</span> <span class="label label-inverse">{{conversation.groups.all|join:", "}}</span> 
             <h3>{{conversation.subject}}</h3>
             <p>{{conversation.message}}</p>
        </div>
        <div class="span12">
            <table class="table table-bordered table-striped">
                <tr>
                    <th>Channel</th>
                    <th>Recipients</th>
                    <th>Cost</th>
                    <th>Status</th>
                </tr>
                <tr>
                    <td><i class="icon-comment"></i> {{conversation.delivery_class_description}}</td>
                    <td>{{conversation.people.count}}</td>
                    <td>12345</td>
                    <td>
                       <div class="progress progress-striped active">
                            <div class="bar" style="width: 67%;"><strong>In progress:</strong> 5 690 / 99 999</div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <hr>
    
    <div class="row">
        <div class="span12">
            <h3>Conversation Dasboard</h3>
        </div>
    </div>
    <div class="row padtop">
        <div class="span4">
            <div id="myChart" style="width: 100%; height: 250px"></div>
        </div>
        <div class="span8">
            <div id="myChart-b" style="width: 100%; height: 250px"></div>
        </div>
        {% comment %}
        <ul>
            <li>Download <a href="{% url dashboard:export_users poll_id=poll_id %}">User data</a><br/><br/></li>
            <li>Download <a href="{% url dashboard:export_results poll_id=poll_id %}">Poll results</a></li>
        </ul>
        {% endcomment %}
    </div>
    
    <hr>

    <div class="row">
        <div class="span12">
            <h3>Conversation Messages</h3>
        </div>
    </div>
    <div class="tabbable padtop">
        <ul class="nav nav-tabs">
           <li class="active"><a href="#1" data-toggle="tab"><strong>People</strong></a></li>
           <li><a href="#2" data-toggle="tab">Our Replies</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane active" id="1">
<!-- 
                <div class="btn-group">
                    <a class="btn active" href="#">All (2 293)</a>
                    <a class="btn" href="#" title="Text Message"><i class="icon-comment"></i> (1 012)</a>
                    <a class="btn" href="#" title="Twitter"><i class="icon-twitter-sign"></i> (563)</a>
                    <a class="btn" href="#" title="Facebook"><i class="icon-facebook-sign"></i>  (411)</a>
                    <a class="btn" href="#" title="Instant Messages"><i class="icon-comments"></i> (42)</a>
                    <a class="btn" href="#" title="Email"><i class="icon-envelope"></i> (42)</a>
                </div>
             <br>
-->
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th width="32">Type</th>
                        <th>Response</th>
                        <th width="70">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for reply in conversation.replies %}
                    <tr>
                        <td><i class="icon-repeat"></i> {{reply.type}}</td>
                        <td>
                            <h6><a href="{% url contacts:person person_pk=reply.contact.pk %}">{{reply.contact}}</a> via {{reply.source}} - {{reply.time}}</h6>
                            <p>{{reply.content}}</p></td>
                        <td><a href="#" class="btn" title="Reply"><i class="icon-repeat"></i> Reply</a></td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3">No one has replied yet</td>
                    </tr>
                    {% endfor %}
<!--                    
                    <tr>
                        <td><i class="icon-retweet"></i></td>
                        <td><h6><a href="person.html">Gustav Praekelt</a> via Twitter - 5 mins ago</h6><p>RT @ajax_ct: Sorry for the late notice, but practice today has been cancelled due to bad weather. :(</p></td>
                        <td><a href="#" class="btn" title="Reply"><i class="icon-repeat"></i> Reply</a></td>
                    </tr>
                    <tr>
                        <td><i class="icon-thumbs-up"></i></td>
                        <td><p><a href="person.html">Kabelo Mapoka</a>  like this on Facebook 6 mins ago</p>
                        <td></td>
                    </tr>
                    <tr>
                        <td><i class="icon-remove"></i></td>
                        <td><p><a href="person.html">Gavin Wilmore</a> unsubscribed via text message 10 mins ago</p>
                        <td></td>
                    </tr>
                    <tr>
                        <td><i class="icon-repeat"></i></td>
                        <td><h6><a href="person.html">Morgan Collett</a> via Text Message - 15 mins ago</h6><p>Anybody swinging by the training ground? I got dropped off and need a ride back to Durbanville</p></td>
                        <td><a href="#" class="btn" title="Reply"><i class="icon-repeat"></i> Reply</a></td>
                    </tr>
                    <tr>
                        <td><i class="icon-repeat"></i></td>
                        <td><h6><a href="person.html">Hulisani Ravele</a> via Facebook - 20 mins ago</h6><p>whoop whoop! what lousy weather</p></td>
                        <td><a href="#" class="btn" title="Reply"><i class="icon-repeat"></i> Reply</a></td>
                    </tr>
                    <tr>
                        <td><i class="icon-repeat"></i></td>
                        <td><h6><a href="person.html">Belinda Lewis</a> via Twitter - 20 mins ago</h6><p>@ajax_ct: When is practice going to be re-scheduled for? Huuuge game on saturday - don't want to jeopardise chances...</p>
                            <div class="well"><h6>Praekelt Foundation via Vumi Go - 20 mins ago <span class="label label-info">Our Reply</span></h6><p>Hello Belinda, practice is re-scheduled for Thursday</p></div>
                        </td>
                        <td><a href="#" class="btn" title="Reply"><i class="icon-repeat"></i> Reply</a></td>
                    </tr>
-->
                </tbody>
            </table>
            </div>
            <div class="tab-pane" id="2">
<!--            
                <div class="btn-group">
                    <a class="btn active" href="#">All (30)</a>
                    <a class="btn" href="#" title="Text Message"><i class="icon-comment"></i> (20)</a>
                    <a class="btn" href="#" title="Twitter"><i class="icon-twitter-sign"></i> (5)</a>
                    <a class="btn" href="#" title="Facebook"><i class="icon-facebook-sign"></i>  (3)</a>
                    <a class="btn" href="#" title="Instant Messages"><i class="icon-comments"></i> (2)</a>
                    <a class="btn disabled" href="#" title="Email"><i class="icon-envelope"></i> (0)</a>
                </div>
             <br>
-->
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th width="32">Type</th>
                        <th>Response</th>
                        <th width="70">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for reply in conversation.replies.outbound %}
                    <tr>
                        <td><i class="icon-repeat"></i> {{reply.type}}</td>
                        <td>
                            <h6><a href="{% url contacts:person person_pk=reply.contact.pk %}">{{reply.contact}}</a> via {{reply.source}} - {{reply.time}}</h6>
                            <p>{{reply.content}}</p></td>
                        <td><a href="#" class="btn" title="Reply"><i class="icon-repeat"></i> Reply</a></td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3">No one has replied yet</td>
                    </tr>
                    {% endfor %}
<!--                    
                    <tr>
                        <td><i class="icon-retweet"></i></td>
                        <td><h6><a href="person.html">Gustav Praekelt</a> via Twitter - 5 mins ago</h6><p>RT @ajax_ct: Sorry for the late notice, but practice today has been cancelled due to bad weather. :(</p></td>
                        <td><a href="#" class="btn" title="Reply"><i class="icon-repeat"></i> Reply</a></td>
                    </tr>
                    <tr>
                        <td><i class="icon-thumbs-up"></i></td>
                        <td><p><a href="person.html">Kabelo Mapoka</a>  like this on Facebook 6 mins ago</p>
                        <td></td>
                    </tr>
                    <tr>
                        <td><i class="icon-remove"></i></td>
                        <td><p><a href="person.html">Gavin Wilmore</a> unsubscribed via text message 10 mins ago</p>
                        <td></td>
                    </tr>
                    <tr>
                        <td><i class="icon-repeat"></i></td>
                        <td><h6><a href="person.html">Morgan Collett</a> via Text Message - 15 mins ago</h6><p>Anybody swinging by the training ground? I got dropped off and need a ride back to Durbanville</p></td>
                        <td><a href="#" class="btn" title="Reply"><i class="icon-repeat"></i> Reply</a></td>
                    </tr>
                    <tr>
                        <td><i class="icon-repeat"></i></td>
                        <td><h6><a href="person.html">Hulisani Ravele</a> via Facebook - 20 mins ago</h6><p>whoop whoop! what lousy weather</p></td>
                        <td><a href="#" class="btn" title="Reply"><i class="icon-repeat"></i> Reply</a></td>
                    </tr>
                    <tr>
                        <td><i class="icon-repeat"></i></td>
                        <td><h6><a href="person.html">Belinda Lewis</a> via Twitter - 20 mins ago</h6><p>@ajax_ct: When is practice going to be re-scheduled for? Huuuge game on saturday - don't want to jeopardise chances...</p>
                            <div class="well"><h6>Praekelt Foundation via Vumi Go - 20 mins ago <span class="label label-info">Our Reply</span></h6><p>Hello Belinda, practice is re-scheduled for Thursday</p></div>
                        </td>
                        <td><a href="#" class="btn" title="Reply"><i class="icon-repeat"></i> Reply</a></td>
                    </tr>
-->
                </tbody>
            </table>
            </div>
        </div>  
      </div>
{% endblock %}

{% block extra_js %}
<script src="{{ STATIC_URL }}js/libs/highcharts.js"></script>
<script src="{{ STATIC_URL }}js/libs/conv-dash.js"></script>
{% endblock %}