{% extends "wizard_views/wizard_base.html" %}

{% block content_extraclass %}{{ block.super }} dialogue{% endblock %}

{% block content_actions_left %}
    <button class="btn btn-primary" data-action='new-state'>
        Create new message
    </button>
{% endblock %}

{% block content_main %}
<div id="diagram"></div>
{% endblock %}

{% block modals %}
<div id="initiateModal" class="modal hide fade in">
    <form method="post" action="">
        <div class="modal-header">
            <h3>How do you intend to initiate the campaign?</h3>
        </div>

        <div class="modal-body">
                {% csrf_token %}
                {{ initiate_form }}
        </div>
        <div class="modal-footer">
            <button class="btn btn-link" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary point-right">Next step</button>
        </div>
    </form>
</div>
{% endblock %}

{% block ondomready %}
  {{ block.super }}
  var dialogue = go.campaign.dialogue;

  $('.breadcrumbs a').eq(1).addClass('active');

  $('.actions button[data-action="save"]').click(function(e) {
      e.preventDefault();
      $('#initiateModal').modal('show');
  });

  _(jsPlumb.Defaults.EndpointStyle).extend({
    radius: 8,
    fillStyle: '#0bcac3'
  });

  _(jsPlumb.Defaults.PaintStyle).extend({
    lineWidth: 4,
    strokeStyle: '#0bcac3'
  });

  jsPlumb.Defaults.Connector = ['Flowchart', {stub: 5}];

  var diagram = new dialogue.diagram.DialogueDiagramView({
    el: '.dialogue #diagram',
    model: new dialogue.models.DialogueModel({{ model_data|safe }})
  });

  $('.actions [data-action="new-state"]').click(function(e) {
      e.preventDefault();
      diagram.newState();
  });

  diagram.render();
{% endblock %}
