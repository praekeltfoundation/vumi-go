{% extends "app.html" %}

{% block content_title %}New Channel{% endblock %}

{% block content_extraclass %}channels new{% endblock %}

{% block content_main %}
<div class="row">
    <div class="span12">
        {% include "base/includes/messages.html" %}
    </div>
</div>

<form id="form-channels" class="indent" method="post" action="">
    {% csrf_token %}

    <fieldset class="configuration_new row-fluid boxes">

        <div class="span4">
            <div class="box">
                <label for="id_{{ form_config.country.name }}">
                    {{ form_config_new.country.label }}
                </label>

                {{ form_config_new.country }}

            </div>
        </div>

        <div class="span4 channel">
            <div class="box">
                <label for="id_{{ form_config.channel.name }}">
                  {{ form_config_new.channel.label }}
                </label>
                
                {% for country, channels in form_config_new.channel_options.items %}
                    <select name="{{ form_config_new.channel.name }}"
                        data-relation-key="{{ country }}">
                        {% for channel in channels %}
                        <option value="{{ channel.0 }}:">
                            {{ channel.1 }}
                        </option>
                        {% endfor %}
                    </select>
                {% endfor %}
            </div>
        </div>

        <div class="span4">
            <div class="box">
                <br>
                <input type="submit" class="btn btn-primary" value="Save">
            </div>
        </div>
    </fieldset>
</form>
{% endblock %}


{% block ondomready %}
    {{ block.super }}

    $('.country select').on('change', function() {
        var v = $(this).find(':checked').val();
        $('.channel select').hide();
        $('.channel select[data-relation-key="' + v + '"]').show();
    });
    // trigger change in order to show the first select box.
    $('.country select').trigger('change');

    $('#form-channels').on('submit', function() {
        // remove all the select elements that are hidden, so that they're
        // not posted.
        $(this).find('select:hidden').remove();
    });
{% endblock %}
