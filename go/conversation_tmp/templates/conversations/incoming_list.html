{% extends "app.html" %}
{% load url from future %}


{% block content_extraclass %}campaigns{% endblock %}

{% block content_title %}{{ conversation.name }} messages{% endblock %}



{% block content_actions_left %}
{% endblock %}

{% block content_actions_right %}
    <div class="pull-left">
        <button class="btn">Download .csv</button>

    </div>
    <div class="table-form-view-buttons pull-left">
        &nbsp;
        With message:
        <button class="btn" disabled="disabled">Delete</button>
    </div>
    

    <form id="search-filter" name="search-filter" action="" method="get" class="navbar-search pull-right">
        <input type="text" class="search-query" placeholder="Search" name="{{ search_form.query.name }}" value="{{ search_form.query.value|default:"" }}">
        <button type="submit" class="btn" id="search-filter-btn">Search</button>
    </form>
{% endblock %}

{% block content_main %}
<form class="table-form-view" method="post" action="">
    <div class="row-fluid">
        <div class="span3 sidebar">

            <ul class="nav nav-list">
                <li>
                    <a href="{% url 'conversations:incoming_list' conversation.key %}" class="active">All messages</a>
                </li>
            </ul>

        </div>
        <div class="span9">

            {% include "base/includes/messages.html" %}

            <table class="table">
                <thead>
                    <tr>
                        <th><input type="checkbox"></th>
                        <th>Contact</th>
                        <th>Messages Per Thread</th>
                        <th>Messages</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    {# TODO the message key here is fake. #}
                    {% for message in message_list %}
                    <tr data-url="{% url 'conversations_tmp:incoming_detail' conversation.key 1 %}">
                        <td><input type="checkbox" value="{{ message.key }}"></td>
                        <td>
                            <a href="{% url 'conversations_tmp:incoming_detail' conversation.key 1 %}">
                                {{ message.contact }}
                            </a>
                        </td>
                        <td>{{ message.threads }}</td>
                        <td>{{ message.messages }}</td>
                        <td>{{ message.date }}</td>
                    </tr>
                    {% empty %}
                        <tr>
                            <td colspan="5">
                            {% if query %}
                                No contacts match <strong>{{ query }}</strong>
                            {% else %}
                                No messages
                            {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                    {% if paginator.num_pages > 1 %}
                    <tr colspan="5">
                        {% include "base/includes/pagination.html" %}
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</form>
{% endblock %}

{% block ondomready %}
    var tableFormView = new go.components.tables.TableFormView({
        el: '.table-form-view',
        actions: '.table-form-view-buttons button',
    });
{% endblock %}
