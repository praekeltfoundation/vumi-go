{% extends "app.html" %}
{% load url from future %}

{% block content_extraclass %}campaigns{% endblock %}

{# TODO, title #}
{% block content_title %}
    Campaign Routing
{% endblock %}

{% block content_actions_right %}
    <a href="{% url 'conversations:index' %}">Cancel</a>

    {# TODO Send model data back to server when clicked #}
    <a href="" class="btn btn-primary">Save</a>
{% endblock %}

{% block content_main %}
    <div class="container">
      <div id="routing-diagram" class="row">
          <div class="span4 column-container">
            <span class="title">Channels</span>
            {# TODO Go to to new channel screen #}
            <a href="" class="btn btn-primary new">+</a>
            <div class="column" id="channels"></div>
          </div>

          <div class="span4 column-container">
            <span class="title">Routing Blocks</span>
            {# TODO Go to to new routing block screen #}
            <a href="" class="btn btn-primary new">+</a>
            <div class="column" id="routing-blocks"></div>
          </div>

          <div class="span4 column-container">
            <span class="title">Conversations</span>
            {# TODO Go to to new conversation screen #}
            <a href="" class="btn btn-primary new">+</a>
            <div class="column" id="conversations"></div>
          </div>
      </div>
    </div>
{% endblock %}

{% block ondomready %}
    {{ block.super }}

jsPlumb.ready(function() {
  var routing = go.campaign.routing,
      modelData = {{ model_data|safe }},
      CampaignRoutingModel = routing.CampaignRoutingModel,
      RoutingDiagramView = routing.RoutingDiagramView;

  jsPlumb.Defaults.Connector = ['StateMachine'];

  _(jsPlumb.Defaults.EndpointStyle).extend({
    radius: 3,
    fillStyle: '#2f3436'
  });

  _(jsPlumb.Defaults.PaintStyle).extend({
    lineWidth: 2,
    strokeStyle: '#2f3436'
  });

  var diagram = new RoutingDiagramView({
    el: '#routing-diagram',
    model: new CampaignRoutingModel(modelData)
  });

  diagram.render();

});
{% endblock %}
